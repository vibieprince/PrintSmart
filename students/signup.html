<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Signup - PrintSmart</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <style>
    body {
      background:
        radial-gradient(circle at top left, #1e1b4b 0%, #020617 35%, #000000 100%),
        linear-gradient(180deg, #312e81 0%, #020617 50%, #000000 100%);
      background-attachment: fixed;
      background-repeat: no-repeat;
      background-size: cover;
    }

    .glass-card {
      background: rgba(15, 23, 42, 0.85);
      backdrop-filter: blur(14px);
      border: 1px solid rgba(99, 102, 241, 0.22);
    }

    .glow-btn {
      background: linear-gradient(135deg, #6366f1, #4f46e5);
      transition: all 0.2s ease;
    }

    .glow-btn:hover {
      box-shadow: 0 0 18px rgba(99, 102, 241, 0.6);
      transform: translateY(-1px);
    }
  </style>
</head>

<body class="text-slate-100">

<div class="min-h-screen flex items-center justify-center px-3">

  <div class="w-full max-w-xs sm:max-w-md glass-card rounded-2xl p-5 sm:p-8 shadow-2xl">

    <div class="text-center mb-5">
      <div class="w-11 h-11 sm:w-14 sm:h-14 mx-auto mb-2 rounded-xl flex items-center justify-center bg-gradient-to-br from-indigo-500 via-violet-500 to-sky-400 shadow-lg">
        <span class="font-black text-sm sm:text-lg">PS</span>
      </div>

      <h2 class="text-lg sm:text-3xl font-bold">Create Account ðŸš€</h2>
      <p class="text-slate-400 text-xs sm:text-sm">
        Start your smart printing journey
      </p>
    </div>

    <button type="button" onclick="googleSignup()" class="w-full flex items-center justify-center gap-2 bg-white text-slate-800 font-semibold py-2 rounded-lg shadow hover:shadow-lg transition text-sm mb-4">
      <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="w-4 h-4">
      Sign up with Google
    </button>

    <div class="relative flex items-center justify-center my-4">
      <div class="absolute w-full border-t border-slate-600"></div>
      <span class="relative bg-slate-900 px-3 py-0.5 text-xs text-slate-400 rounded-full">
        or sign up with email
      </span>
    </div>

    <form id="signupForm" class="space-y-3">

      <div>
        <label class="text-xs text-slate-400">Full Name</label>
        <div class="relative">
          <i class="fas fa-user absolute left-3 top-2.5 text-slate-400 text-xs"></i>
          <input id="fullName" type="text" required
            class="w-full bg-slate-900/70 border border-slate-700 rounded-lg py-2 pl-9 pr-3 text-sm focus:outline-none focus:ring-1 focus:ring-indigo-500"
            placeholder="Prince Singh">
        </div>
      </div>

      <div>
        <label class="text-xs text-slate-400">College Email</label>
        <div class="relative">
          <i class="fas fa-envelope absolute left-3 top-2.5 text-slate-400 text-xs"></i>
          <input id="email" type="email" required
            class="w-full bg-slate-900/70 border border-slate-700 rounded-lg py-2 pl-9 pr-3 text-sm focus:outline-none focus:ring-1 focus:ring-indigo-500"
            placeholder="student@college.edu">
        </div>
      </div>

      <div>
        <label class="text-xs text-slate-400">Mobile Number</label>
        <div class="relative">
          <i class="fas fa-phone absolute left-3 top-2.5 text-slate-400 text-xs"></i>
          <input id="mobile" type="tel" required
            class="w-full bg-slate-900/70 border border-slate-700 rounded-lg py-2 pl-9 pr-3 text-sm focus:outline-none focus:ring-1 focus:ring-indigo-500"
            placeholder="+91 XXXXX XXXXX">
        </div>
      </div>

      <div>
        <label class="text-xs text-slate-400">Password</label>
        <div class="relative">
          <i class="fas fa-lock absolute left-3 top-2.5 text-slate-400 text-xs"></i>
          <input id="password" type="password" required
            class="w-full bg-slate-900/70 border border-slate-700 rounded-lg py-2 pl-9 pr-3 text-sm focus:outline-none focus:ring-1 focus:ring-indigo-500"
            placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
        </div>
      </div>

      <button type="submit"
        class="w-full glow-btn py-2 rounded-lg font-semibold text-sm text-white">
        Create Account
      </button>
    </form>
    
    <p id="errorMsg" class="text-red-400 text-xs mt-2 hidden text-center"></p>

    <p class="text-center text-xs text-slate-400 mt-4">
      Already have an account?
      <a href="/students/index.html" class="text-indigo-400 font-semibold hover:underline">
        Login here
      </a>
    </p>

  </div>
</div>

<script>
  // 1. Initialize Firebase (Exact same config)
  const firebaseConfig = {
    apiKey: "AIzaSyDFoM9lP2TFF0PqgGwtAFN8YoGSJznhujc",
    authDomain: "printsmart-ebcdd.firebaseapp.com",
    databaseURL: "https://printsmart-ebcdd-default-rtdb.firebaseio.com",
    projectId: "printsmart-ebcdd"
  };

  if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
  }
  const auth = firebase.auth();
  const db = firebase.database();

  // Loader HTML
  const loader = document.createElement("div");
  loader.innerHTML = `
  <div style="position:fixed;inset:0;background:#000000cc;display:flex;align-items:center;justify-content:center;z-index:9999">
    <div style="text-align:center;">
        <div style="width: 40px; height: 40px; border: 4px solid #6366f1; border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 10px;"></div>
        <div style="color:white;font-size:16px">Creating Account...</div>
    </div>
  </div>
  <style>@keyframes spin { to { transform: rotate(360deg); } }</style>
  `;

  // 2. EMAIL SIGNUP LOGIC
  document.getElementById("signupForm").addEventListener("submit", (e) => {
    e.preventDefault();
    
    const name = document.getElementById("fullName").value;
    const email = document.getElementById("email").value;
    const mobile = document.getElementById("mobile").value;
    const password = document.getElementById("password").value;
    const errorMsg = document.getElementById("errorMsg");

    document.body.appendChild(loader);
    errorMsg.classList.add("hidden");

    auth.createUserWithEmailAndPassword(email, password)
      .then((userCredential) => {
        // A. Update Auth Profile (So dashboard shows name instantly)
        return userCredential.user.updateProfile({
          displayName: name
        }).then(() => {
          return userCredential.user;
        });
      })
      .then((user) => {
        // B. Save extra details (Mobile, Name) to Realtime Database
        return db.ref('students/' + user.uid).set({
          name: name,
          email: email,
          mobile: mobile,
          createdAt: firebase.database.ServerValue.TIMESTAMP
        });
      })
      .then(() => {
        console.log("Account Created!");
        // Redirect handled by onAuthStateChanged
      })
      .catch((error) => {
        if(loader.parentNode) loader.parentNode.removeChild(loader);
        errorMsg.textContent = error.message;
        errorMsg.classList.remove("hidden");
      });
  });

  // 3. GOOGLE SIGNUP LOGIC
  function googleSignup() {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider)
      .then((result) => {
        document.body.appendChild(loader);
        
        // Save minimal data to DB for Google users too
        const user = result.user;
        db.ref('students/' + user.uid).update({
          name: user.displayName,
          email: user.email,
          lastLogin: firebase.database.ServerValue.TIMESTAMP
        });
      })
      .catch((error) => {
        alert("Google Signup Failed: " + error.message);
      });
  }

  // 4. REDIRECT ON SUCCESS
  auth.onAuthStateChanged(user => {
    if (user) {
      // Save ID for dashboard session
      localStorage.setItem("studentUID", user.uid);
      window.location.replace("/students/dashboard.html");
    }
  });
</script>

</body>
</html>