<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Shop Owner Auth - PrintSmart</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .gradient-bg {
      background-color: #2d3436;
      background-image: linear-gradient(315deg, #2d3436 0%, #000000 74%);
    }
  </style>
</head>
<body class="gradient-bg min-h-screen">
  <!-- Navigation Bar -->
  <header class="container mx-auto px-4 py-6">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-2">
        <svg class="h-8 w-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
        </svg>
        <h1 class="text-2xl font-bold text-white">Print Smart</h1>
      </div>
      <nav>
        <button onclick="goBack()" class="text-white hover:text-gray-300 flex items-center gap-2">
          <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M10 19l-7-7m0 0l7-7m-7 7h18" />
          </svg>
          Back to Home
        </button>
      </nav>
    </div>
  </header>

  <!-- Auth Section -->
  <main class="container mx-auto px-4 py-8">
    <div class="max-w-md mx-auto">
      <div class="bg-white bg-opacity-10 backdrop-blur border border-white border-opacity-20 rounded-lg p-8">
        <div class="text-center mb-6">
          <svg class="h-16 w-16 text-green-400 mx-auto mb-4" fill="none" viewBox="0 0 24 24" style="color: white" xmlns="http://www.w3.org/2000/svg" class="bi bi-shop-window" viewBox="0 0 16 16"> <path d="M2.97 1.35A1 1 0 0 1 3.73 1h8.54a1 1 0 0 1 .76.35l2.609 3.044A1.5 1.5 0 0 1 16 5.37v.255a2.375 2.375 0 0 1-4.25 1.458A2.371 2.371 0 0 1 9.875 8 2.37 2.37 0 0 1 8 7.083 2.37 2.37 0 0 1 6.125 8a2.37 2.37 0 0 1-1.875-.917A2.375 2.375 0 0 1 0 5.625V5.37a1.5 1.5 0 0 1 .361-.976l2.61-3.045zm1.78 4.275a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 1 0 2.75 0V5.37a.5.5 0 0 0-.12-.325L12.27 2H3.73L1.12 5.045A.5.5 0 0 0 1 5.37v.255a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0zM1.5 8.5A.5.5 0 0 1 2 9v6h12V9a.5.5 0 0 1 1 0v6h.5a.5.5 0 0 1 0 1H.5a.5.5 0 0 1 0-1H1V9a.5.5 0 0 1 .5-.5zm2 .5a.5.5 0 0 1 .5.5V13h8V9.5a.5.5 0 0 1 1 0V13a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V9.5a.5.5 0 0 1 .5-.5z" fill="white"></path> </svg>
          <h2 class="text-2xl font-bold text-white mb-2">Shop Owner Portal</h2>
          <p class="text-gray-300">Login or register your print shop</p>
        </div>

        <!-- Toggle Tabs -->
        <div class="flex mb-6 bg-white bg-opacity-5 rounded-lg p-1">
          <button id="loginTab" onclick="switchTab('login')"
            class="flex-1 py-2 px-4 rounded-md transition-all text-white font-medium bg-green-600">Login</button>
          <button id="signupTab" onclick="switchTab('signup')"
            class="flex-1 py-2 px-4 rounded-md transition-all text-white font-medium">Sign Up</button>
        </div>

        <!-- Login Form -->
        <form id="loginForm" class="space-y-4">
          <input type="email" id="loginEmail" placeholder="Email"
            class="w-full p-2 rounded bg-white bg-opacity-20 text-white placeholder-gray-300" required>
          <input type="password" id="loginPassword" placeholder="Password"
            class="w-full p-2 rounded bg-white bg-opacity-20 text-white placeholder-gray-300" required>
          <button type="submit"
            class="w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded">Login</button>
        </form>

        <!-- Signup Form -->
        <form id="signupForm" class="space-y-4 hidden mt-6">
          <label class="block "></label>
          <select id="citySelect" class="w-full p-2 rounded text-black">
            <option value="">-- Select City --</option>
            <option value="Delhi">Delhi</option>
            <option value="Noida">Noida</option>
            <option value="Lucknow">Lucknow</option>
          </select>
          <input type="text" id="signupShopName" placeholder="Shop Name"
            class="w-full p-2 rounded bg-white bg-opacity-20 text-white placeholder-gray-300" required>
          <input type="tel" id="signupMobile" placeholder="Mobile Number"
          class="w-full p-2 rounded bg-white bg-opacity-20 text-white placeholder-gray-300" required>
          <input type="email" id="signupEmail" placeholder="Email"
            class="w-full p-2 rounded bg-white bg-opacity-20 text-white placeholder-gray-300" required>
          <input type="password" id="signupPassword" placeholder="Password"
            class="w-full p-2 rounded bg-white bg-opacity-20 text-white placeholder-gray-300" required>
          <button type="submit"
            class="w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded">Sign Up</button>
        </form>

      </div>
    </div>
  </main>

  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
  import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBq9io3x4gJNva_sqNjEDvoAXIFOX_-o94",
    authDomain: "print-smart-94a3a.firebaseapp.com",
    databaseURL: "https://print-smart-94a3a-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "print-smart-94a3a",
    storageBucket: "print-smart-94a3a.appspot.com",
    messagingSenderId: "767378936239",
    appId: "1:767378936239:web:88cce1882ab5a1753c1f5a",
    measurementId: "G-B51B3JZ11T"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  // ðŸ” LOGIN
  document.getElementById("loginForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const email = document.getElementById("loginEmail").value;
    const password = document.getElementById("loginPassword").value;

    try {
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;
      const uid = user.uid;

      const shopRef = ref(db, "shopOwners/" + uid);
      const snapshot = await get(shopRef);

      if (snapshot.exists()) {
        const shopData = snapshot.val();

        localStorage.setItem("role", "shopOwner");
        localStorage.setItem("email", email);
        localStorage.setItem("shopName", shopData.shopName);
        localStorage.setItem("mobile", shopData.mobile);
        localStorage.setItem("shopUID", uid);

        window.location.href = "shop-dashboard.html";
      } else {
        alert("Shop data not found. Please contact support.");
      }
    } catch (error) {
      alert("Login failed: " + error.message);
    }
  });

  // ðŸ“ SIGNUP
  document.getElementById("signupForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const shopName = document.getElementById("signupShopName").value;
    const mobile = document.getElementById("signupMobile").value;
    const email = document.getElementById("signupEmail").value;
    const password = document.getElementById("signupPassword").value;
    const city = document.getElementById("citySelect").value;

    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;
      const uid = user.uid;

      await set(ref(db, "shopOwners/" + uid), {
        shopName,
        email,
        mobile,
        city
      });

      // âœ… Fix: Store shopUID in localStorage during signup
      localStorage.setItem("role", "shopOwner");
      localStorage.setItem("email", email);
      localStorage.setItem("shopName", shopName);
      localStorage.setItem("mobile", mobile);
      localStorage.setItem("city", city);
      localStorage.setItem("shopUID", uid);

      alert("Signup successful! Redirecting...");
      window.location.href = "shop-dashboard.html";
    } catch (error) {
      alert("Signup failed: " + error.message);
    }
  });

  window.switchTab = function (tab) {
    const loginForm = document.getElementById("loginForm");
    const signupForm = document.getElementById("signupForm");
    const loginTab = document.getElementById("loginTab");
    const signupTab = document.getElementById("signupTab");

    if (tab === "login") {
      loginForm.classList.remove("hidden");
      signupForm.classList.add("hidden");
      loginTab.classList.add("bg-green-600");
      signupTab.classList.remove("bg-green-600");
    } else {
      signupForm.classList.remove("hidden");
      loginForm.classList.add("hidden");
      signupTab.classList.add("bg-green-600");
      loginTab.classList.remove("bg-green-600");
    }
  };

  window.goBack = () => window.location.href = "index.html";
</script>
</body>
</html>
